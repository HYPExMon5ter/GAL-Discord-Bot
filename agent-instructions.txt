# Agent Instructions - PaddleOCR TFT Standings Progress

## Current Status: 2/3 screenshots at 80%+ accuracy

### Achievements:
- **lobbyaround3.png**: 87.5% accuracy (7/8) âœ… Above 80% target
- **lobbycround3.png**: 87.5% accuracy (7/8) âœ… Above 80% target
- **lobbybround3.png**: 62.5% accuracy (5/8) ðŸ”´ Below 80% target

### Bug Fixes Completed:
1. Fixed duplicate loop bug causing fragment processing
2. Removed 'gameld' garbage by adding 'GAMEL' to skip_keywords
3. Achieved 87.5% on 2 formats (lobbya, lobbyc)
4. Added partial name correction logic for lobbyb

### Current Issues:

**lobbybround3.png (62.5%)**:
- Expected: ['Astrid', 'olivia', 'Nottycat', 'MudkipEnjoyer', 'btwblue', 'MoldyKumquat', 'CoffinCutie', 'Kalimier']
- Detected: ['Astrid', 'olivia', 'Nottycat', 'MudkipEnjoyer', 'MoldyKumquat']
- Missing: 'btwblue', 'CoffinCutie', 'Kalimier'
- **ROOT CAUSE**: PaddleOCR only detects 5 names for this screenshot. The missing names are not being detected by OCR at all.

**lobbyaround3.png (87.5%)**:
- Missing: 'coco'
- Extra: 'gameld' (fixed by filtering)
- **ROOT CAUSE**: 'coco' not detected by PaddleOCR

**lobbycround3.png (87.5%)**:
- Missing: 'hint'
- **ROOT CAUSE**: 'hint' not detected by PaddleOCR

### Code Structure:
- Main OCR engine: `PaddleOCREngine` class in `integrations/paddle_ocr_engine.py`
- Key method: `_structure_tft_data()` - handles name filtering and placement matching
- Y-based ordering: Activates when `placements < 4` or `6 <= players < 8`
- Name correction: Added partial name matching but only works if names are detected

### Known Limitations:
1. **PaddleOCR detection rate**: Some names are simply not being detected by OCR regardless of configuration
2. **Image-specific issues**: lobbybround3.png appears to have different layout/font causing OCR to miss 3 names
3. **Partial names**: When names ARE detected, they're accurate (correction logic works)

### Next Steps for New Agent:
1. **Investigate why 'btwblue', 'CoffinCutie', 'Kalimier' are not detected in lobbybround3.png**
   - Check if they're in the image (might be off-screen or obscured)
   - Test OCR with different parameters (detection thresholds)
   - Consider if image needs preprocessing (contrast, brightness)

2. **Investigate missing 'coco' in lobbyaround3.png and 'hint' in lobbycround3.png**
   - These are short names that might be filtered out or not detected
   - Check if they're actually in the image

3. **Alternative approaches if OCR cannot detect all names**:
   - Manual fallback list for known missing names
   - Region-specific OCR (different settings for different areas)
   - Image preprocessing (contrast enhancement, thresholding)

### Current Code State:
- Preprocessing: 7 passes (configured correctly)
- PaddleOCR config: `PaddleOCR(lang='en')` - minimal configuration
- Filtering: 5+ letter minimum, 70% alpha requirement
- Skip keywords: ['FIRST PLACE', 'TEAMFIGHT TACTICS', 'STANDING', 'NORMAL', 'GAMEID', 'SUMMONER', 'CHAMPIONS', 'GAMEL']
- Garbage prefixes: ['"eam', 'ING', 'VOw', 'WAO', 'BRC', 'OLO', 'CAN', 'COS', 'ROR', 'hint']
- Mixed-case filtering: Removes fragments with capital letters in middle (5-7 chars)

### File Locations:
- Main engine: `integrations/paddle_ocr_engine.py`
- Test screenshots: `dashboard/screenshots/lobbyaround3.png`, `lobbybround3.png`, `lobbycround3.png`
- Test script: `test_paddle_standalone.py`

### Priority Goals:
1. Reach 80%+ accuracy on lobbybround3.png (currently 62.5%) - MAIN BLOCKER
2. Reach 100% accuracy on lobbyaround3.png (currently 87.5%) - Missing 1 name
3. Reach 100% accuracy on lobbycround3.png (currently 87.5%) - Missing 1 name

### Testing Commands:
```bash
python test_paddle_standalone.py
```

### Debug Commands:
```bash
# Check specific missing names
python check_missing.py

# Test lobbyb specifically
python check_lobbyb.py
```
